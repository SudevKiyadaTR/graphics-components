{"version":3,"file":"AdSlot.stories-06cc65ab.js","sources":["../../src/components/AdSlot/stories/docs/component.md?raw","../../src/components/AdSlot/adScripts/getParameterByName.ts","../../src/components/AdSlot/adScripts/ias.ts","../../src/components/AdSlot/adScripts/loadScript.ts","../../src/components/AdSlot/adScripts/bootstrap.ts","../../src/components/AdSlot/AdScripts.svelte","../../src/components/AdSlot/AdSlot.svelte","../../src/components/AdSlot/AdSlot.stories.svelte"],"sourcesContent":["export default \"Display a FreeStar Ad Slot\\n\\nNote: You must use this domain to access the story book:\\n`http://localhost.arcpublishing.com:3000`\\n\\nThis domain has been whitelisted on the Ad server. To setup the domain locally, add the following line to `/etc/hosts`:\\n\\n```\\n127.0.0.1 localhost localhost.arcpublishing.com\\n```\\n\\n```svelte\\n<script>\\n  import { AdSlot, AdScripts } from '@reuters-graphics/graphics-components';\\n</script>\\n\\n<!-- Include only ONCE per page -->\\n<AdScripts />\\n\\n<AdSlot\\n  placementName=\\\"reuters_desktop_native\\\"\\n  slotId=\\\"reuters_desktop_native\\\"\\n/>\\n\\n<AdSlot\\n  placementName=\\\"reuters_desktop_native\\\"\\n  slotId=\\\"reuters_desktop_native\\\"\\n/>\\n```\\n\"","export default (name: string, url = window.location.href) => {\n  // eslint-disable-next-line no-useless-escape\n  name = name.replace(/[\\[\\]]/g, '\\\\$&');\n  const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)');\n  const results = regex.exec(url);\n\n  if (!results) return null;\n\n  if (!results[2]) return '';\n\n  return decodeURIComponent(results[2].replace(/\\+/g, ' '));\n};\n","const IAS_REQUEST_TIMEOUT = 600;\n\nexport default () => {\n  return new Promise((resolve) => {\n    const timerId = setTimeout(() => {\n      resolve('Resolved with timeout');\n    }, IAS_REQUEST_TIMEOUT);\n\n    const setupIAS = () => {\n      clearTimeout(timerId);\n      (<any>window).__iasPET = (<any>window).__iasPET || {};\n      (<any>window).__iasPET.queue = (<any>window).__iasPET.queue || [];\n      (<any>window).__iasPET.pubId = '931336'; // Ask Rachel\n      resolve('loaded');\n    };\n\n    // Set up IAS pet.js\n    const script = document.createElement('script');\n    script.src = '//static.adsafeprotected.com/iasPET.1.js';\n    script.setAttribute('async', 'async');\n    document.head.appendChild(script);\n    script.onload = setupIAS;\n    script.onerror = () => {\n      resolve('error');\n    };\n  });\n};\n","export const loadScript = (src: string, onload?: () => void) => {\n  const script = document.createElement('script');\n  script.addEventListener('load', onload);\n  script.src = src;\n  document.head.append(script);\n};\n","import getParameterByName from './getParameterByName';\nimport Ias from './ias';\nimport { loadScript } from './loadScript';\n\nconst ONETRUST_LOGS = 'ot_logs';\nconst ONETRUST_GEOLOCATION_MOCK = 'ot_geolocation_mock';\nconst ONETRUST_SCRIPT_ID = '38cb75bd-fbe1-4ac8-b4af-e531ab368caf-test';\n\nexport const loadBootstrap = () => {\n  (<any>window).freestar = (<any>window).freestar || {};\n  const freestar = (<any>window).freestar;\n  freestar.debug = true;\n  freestar.queue = freestar.queue || [];\n  freestar.config = freestar.config || {};\n  freestar.config.enabled_slots = [];\n  freestar.initCallback = function() {\n    freestar.config.enabled_slots.length === 0 ?\n      (freestar.initCallbackCalled = false) :\n      freestar.newAdSlots(freestar.config.enabled_slots);\n  };\n\n  // Ask Rachel\n  freestar.config.channel = '/4735792/reuters.com/home';\n\n  (<any>window).initBootstrap(\n    {\n      onetrust_logs: getParameterByName(ONETRUST_LOGS) || 'false',\n      geolocation_mock:\n        getParameterByName(ONETRUST_GEOLOCATION_MOCK) || 'default',\n      onetrust_script_id: ONETRUST_SCRIPT_ID,\n    },\n    (onetrustResponse) => {\n      const iasPromise = Ias();\n\n      // Ask Thea about Permutive implementation (considering there are no logged in users on Graphics)\n      // Should we use Permutive at all?\n      // Should we import ArcP SDK to graphics to get the same user as logged in on RCom?\n      return Promise.all([iasPromise]).then((responses) => {\n        const [iasResponse] = responses;\n\n        return {\n          ...onetrustResponse,\n          ias: iasResponse,\n        };\n      });\n    }\n  );\n\n  (<any>window).bootstrap.getResults((result) => {\n    // Load Freestar script\n    loadScript('https://a.pub.network/reuters-com/pubfig.min.js');\n\n    // Set GAM\n    (<any>window).googletag = (<any>window).googletag || { cmd: [] };\n    (<any>window).googletag.cmd.push(() => {\n      (<any>window).googletag.pubads().enableSingleRequest();\n      (<any>window).googletag.pubads().enableAsyncRendering();\n      (<any>window).googletag.pubads().collapseEmptyDivs(true);\n\n      // Global Ads test targeting\n      const adstest = new URL(document.location.href).searchParams.get('adstest');\n      if (adstest) {\n        (<any>window).googletag.pubads().setTargeting('adstest', adstest);\n      }\n\n      // Ask Rachel about targeting\n      const template = (<any>document.querySelector('meta[name=\"ad:template\"]'))?.content;\n      if (template) {\n        (<any>window).googletag.pubads().setTargeting('template', template);\n      }\n    });\n\n    if (!Array.isArray((<any>window).graphicsAdQueue)) {\n      console.error('Ad queue not initialized!');\n    }\n\n    freestar.queue.push(function() {\n      freestar.newAdSlots((<any>window).graphicsAdQueue || [], 'foobar');\n    });\n\n    freestar.queue.push(function() {\n      (<any>window).googletag.pubads().set('page_url', 'https://www.reuters.com/'); // This line should only be used for testing\n    });\n  });\n};\n","<script>\n  import { onMount } from 'svelte';\n  import { loadBootstrap } from './adScripts/bootstrap';\n  import { loadScript } from './adScripts/loadScript';\n\n  onMount(() => {\n    window.graphicsAdQueue = window.graphicsAdQueue || [];\n    loadScript(\n      'https://graphics.thomsonreuters.com/cdn/js/bootstrap.static.js',\n      loadBootstrap\n    );\n  });\n</script>\n\n<svelte:head>\n  <link rel=\"preconnect\" href=\"https://a.pub.network/\" crossorigin=\"\" />\n  <link rel=\"preconnect\" href=\"https://b.pub.network/\" crossorigin=\"\" />\n  <link rel=\"preconnect\" href=\"https://c.pub.network/\" crossorigin=\"\" />\n  <link rel=\"preconnect\" href=\"https://d.pub.network/\" crossorigin=\"\" />\n  <link rel=\"preconnect\" href=\"https://c.amazon-adsystem.com\" crossorigin=\"\" />\n  <link rel=\"preconnect\" href=\"https://s.amazon-adsystem.com\" crossorigin=\"\" />\n  <link rel=\"preconnect\" href=\"https://btloader.com/\" crossorigin=\"\" />\n  <link rel=\"preconnect\" href=\"https://api.btloader.com/\" crossorigin=\"\" />\n  <link\n    rel=\"preconnect\"\n    href=\"https://confiant-integrations.global.ssl.fastly.net\"\n    crossorigin=\"\"\n  />\n  <link rel=\"stylesheet\" href=\"https://a.pub.network/reuters-com/cls.css\" />\n</svelte:head>\n","<script lang=\"ts\">\n  /** ✏️ DOCUMENT your chart's props using TypeScript and JSDoc comments like below! */\n\n  type PlacementName =\n    // Disabling leaderboard for now...\n    // | 'reuters_desktop_leaderboard_atf'\n    // | 'reuters_mobile_leaderboard'\n    | 'reuters_desktop_native_1'\n    | 'reuters_mobile_mpu_1'\n    | 'reuters_sponsorlogo'\n    | 'reuters_desktop_canvas';\n\n  /**\n   * The unique placement name from FreeStar dashboard.\n   * @required\n   */\n  export let placementName: PlacementName = 'reuters_desktop_native_1';\n\n  /**\n   * The unique slot Id from FreeStar dashboard.\n   */\n  export let dataFreestarAd: string = '__970x250';\n\n  /** Add an ID to target with SCSS. */\n  export let id: string = '';\n\n  /** Add a class to target with SCSS. */\n  let cls: string = 'my-12';\n  export { cls as class };\n\n  import { onMount } from 'svelte';\n\n  import Block from '../Block/Block.svelte';\n\n  const random4 = () =>\n    Math.floor((1 + Math.random()) * 0x10000)\n      .toString(16)\n      .substring(1);\n\n  const randomAdId = 'ad-' + random4() + random4();\n\n  const getAdType = (placementName: PlacementName) => {\n    switch (placementName) {\n      // case 'reuters_desktop_leaderboard_atf':\n      // case 'reuters_mobile_leaderboard':\n      //   return 'leaderboard';\n      case 'reuters_sponsorlogo':\n        return 'Sponsorlogo';\n      case 'reuters_mobile_mpu_1':\n        return 'mpu';\n      default:\n        return 'native';\n    }\n  };\n\n  onMount(() => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const adstest = urlParams.get('adstest');\n    window.graphicsAdQueue = window.graphicsAdQueue || [];\n    window.graphicsAdQueue.push({\n      placementName,\n      slotId: randomAdId,\n      type: getAdType(placementName),\n      graphicId: window.location.pathname,\n      adstest,\n    });\n  });\n</script>\n\n<!-- @component `AdSlot` [Read the docs.](https://reuters-graphics.github.io/graphics-components/?path=/docs/components-AdSlot--default) -->\n<Block id=\"{id}\" class=\"freestar-adslot {cls}\">\n  <div class=\"ad-block\">\n    <div class=\"ad-label\">Advertisement · Scroll to continue</div>\n    <div class=\"ad-container\">\n      <div class=\"ad-slot__inner\">\n        <div>\n          <div\n            data-freestar-ad=\"{dataFreestarAd || null}\"\n            id=\"{randomAdId}\"\n          ></div>\n        </div>\n      </div>\n    </div>\n  </div>\n</Block>\n\n<style lang=\"scss\">\n  div.ad-block {\n    border-bottom: 1px solid var(--theme-colour-brand-rules);\n    border-top: 1px solid var(--theme-colour-brand-rules);\n    div.ad-label {\n      font-family: Knowledge, 'Source Sans Pro', Arial, Helvetica, sans-serif;\n      font-size: 14px;\n      margin: 6px 0;\n      line-height: 1.333;\n      color: var(--theme-colour-text-secondary);\n      width: 100%;\n      text-align: center;\n    }\n    div.ad-container {\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n      align-items: center;\n      min-height: 415px;\n      @media (max-width: 767.9px) {\n        min-height: 320px;\n      }\n      div.ad-slot__inner {\n        margin: auto 0;\n        width: 100%;\n        max-width: 100%;\n        flex: unset;\n        & > div {\n          display: block;\n          div[data-freestar-ad] {\n            display: flex;\n            flex-direction: column;\n            justify-content: center;\n            align-items: center;\n          }\n        }\n      }\n    }\n  }\n</style>\n","<script>\n  import { Meta, Template, Story } from '@storybook/addon-svelte-csf';\n\n  // Don't lose the \"?raw\" in markdown imports!\n  // @ts-ignore\n  import componentDocs from './stories/docs/component.md?raw';\n\n  import AdScripts from './AdScripts.svelte';\n  import AdSlot from './AdSlot.svelte';\n\n  import { withComponentDocs } from '$docs/utils/withParams.js';\n\n  const meta = {\n    title: 'Components/AdSlot',\n    component: AdSlot,\n    ...withComponentDocs(componentDocs),\n    argTypes: {\n      placementName: {\n        control: 'select',\n        options: [\n          'reuters_desktop_leaderboard_atf',\n          'reuters_desktop_native',\n          'reuters_desktop_canvas',\n        ],\n      },\n      dataFreestarAd: {\n        control: 'select',\n        options: ['__970x250'],\n      },\n    },\n  };\n</script>\n\n<Meta {...meta} />\n\n<Template let:args>\n  <div>\n    <AdScripts />\n    <AdSlot {...args} />\n    <AdSlot placementName=\"reuters_desktop_canvas\" dataFreestarAd=\"__970x250\" />\n  </div>\n</Template>\n\n<Story\n  name=\"Default\"\n  args=\"{{\n    placementName: 'reuters_desktop_native_1',\n    dataFreestarAd: '__970x250',\n  }}\"\n/>\n"],"names":["componentDocs","getParameterByName","name","url","results","IAS_REQUEST_TIMEOUT","Ias","resolve","timerId","setupIAS","script","loadScript","src","onload","ONETRUST_LOGS","ONETRUST_GEOLOCATION_MOCK","ONETRUST_SCRIPT_ID","loadBootstrap","freestar","onetrustResponse","iasPromise","responses","iasResponse","result","adstest","template","_a","append","link0","link1","link2","link3","link4","link5","link6","link7","link8","link9","onMount","attr","div1","div1_data_freestar_ad_value","ctx","insert","target","div5","anchor","div0","div4","div3","div2","dirty","placementName","$$props","dataFreestarAd","id","cls","random4","randomAdId","getAdType","div","AdSlot","withComponentDocs"],"mappings":"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"}